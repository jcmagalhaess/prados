jQuery(function(d){var i=d("#woocommerce-order-items"),r=!1,c={handle_events:function(){i.on("click","button.configure_addons",{action:"configure"},this.clicked_edit_button).on("click","button.edit_addons",{action:"edit"},this.clicked_edit_button)},clicked_edit_button:function(e){var t=d.WCBackboneModal.View.extend({addButton:c.clicked_done_button}),a=d(this).closest("tr.item").attr("data-order_item_id");return r=new t({target:"wc-modal-edit-addon",string:{action:"configure"===e.data.action?wc_pao_admin_order_params.i18n_configure:wc_pao_admin_order_params.i18n_edit,item_id:a}}),c.populate_form(),!1},clicked_done_button:function(t){var e=d.extend({},c.get_taxable_address(),{action:"woocommerce_edit_addon_order_item",item_id:r._string.item_id,dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:wc_pao_admin_order_params.edit_pao_nonce}),a=r.$el.find("form")[0];if(!0===a.reportValidity()){var o=new FormData(a);for(const n in e)o.append(n,e[n]);c.block(r.$el.find(".wc-backbone-modal-content")),d.post({url:woocommerce_admin_meta_boxes.ajax_url,type:"POST",data:o,processData:!1,contentType:!1,cache:!1,success:function(e){e.result&&"success"===e.result?(i.find(".inside").empty(),i.find(".inside").append(e.html),i.trigger("wc_order_items_reloaded"),e.notes_html&&(d("ul.order_notes").empty(),d("ul.order_notes").append(d(e.notes_html).find("li"))),c.unblock(r.$el.find(".wc-backbone-modal-content")),c.block(i,{fadeIn:0}),setTimeout(function(){c.unblock(i)},250),r.closeButton(t)):(window.alert(e.error||wc_pao_admin_order_params.i18n_validation_error),c.unblock(r.$el.find(".wc-backbone-modal-content")))},error:function(){window.alert(wc_pao_admin_order_params.i18n_validation_error),c.unblock(r.$el.find(".wc-backbone-modal-content"))}})}},populate_form:function(){c.block(r.$el.find(".wc-backbone-modal-content"));var e={action:"woocommerce_configure_addon_order_item",item_id:r._string.item_id,dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:wc_pao_admin_order_params.edit_pao_nonce};d.post(woocommerce_admin_meta_boxes.ajax_url,e,function(e){e.result&&"success"===e.result?(r.$el.find("form").html(e.html),c.unblock(r.$el.find(".wc-backbone-modal-content")),c.render_form()):(window.alert(wc_pao_admin_order_params.i18n_form_error),c.unblock(r.$el.find(".wc-backbone-modal-content")),r.$el.find(".modal-close").trigger("click"))})},render_form:function(){var n;r.$el.on("touchstart",".wc-pao-addon-image-swatch",function(e){n=new Date}),r.$el.on("click touchend",".wc-pao-addon-image-swatch",function(e){if((e.preventDefault(),"touchend"===e.type&&n)&&100<new Date-n)return;var e=d(this).data("value"),t=d(this).parents(".wc-pao-addon-wrap"),a=d.parseHTML(d(this).data("price")),o=t.find(".wc-pao-addon-image-swatch-selected-swatch");o.html(""),t.find(".wc-pao-addon-image-swatch").removeClass("selected"),d(this).addClass("selected"),t.find(".wc-pao-addon-image-swatch-select").val(e),o.html(a)}),r.$el.find(".datepicker").each(function(){var a=d(this),e=a.parent(),o=e.find(".reset_date"),n=e.find('input[name="'+a.attr("name")+'-wc-pao-date"]'),t=e.find('input[name="'+a.attr("name")+'-wc-pao-date-gmt-offset"]'),e=(t.length||((t=d("<input/>")).attr("type","hidden"),t.attr("name",a.attr("name")+"-wc-pao-date-gmt-offset"),e.append(t)),new Date),i=parseFloat(wc_pao_admin_order_params.gmt_offset,10),r=e.getTimezoneOffset()/60,t=("default"===wc_pao_admin_order_params.date_input_timezone_reference?t.val(r):"store"===wc_pao_admin_order_params.date_input_timezone_reference&&(e.getHours(),e.getMinutes(),t.val(i)),a.datepicker({beforeShow:function(e,t){wc_pao_admin_order_params.datepicker_class&&(d("#ui-datepicker-div").removeClass(wc_pao_admin_order_params.datepicker_class),d("#ui-datepicker-div").addClass(wc_pao_admin_order_params.datepicker_class))},dateFormat:wc_pao_admin_order_params.datepicker_date_format,changeMonth:!0,changeYear:!0,yearRange:"c-100:c+10"}),a.datepicker("getDate"));null!==t&&"function"==typeof t.getTime&&(t.setHours(e.getHours(),e.getMinutes()),"store"===wc_pao_admin_order_params.date_input_timezone_reference&&(t=WC_PAO.Helper.addMinutes(t,-1*r*60),t=WC_PAO.Helper.addMinutes(t,60*i)),n.val(t.getTime()/1e3),o.show()),a.on("change",function(){var e,t=a.datepicker("getDate");null!==t&&"function"==typeof t.getTime?(e=new Date,t.setHours(e.getHours(),e.getMinutes()),"store"===wc_pao_admin_order_params.date_input_timezone_reference&&(t=WC_PAO.Helper.addMinutes(t,-1*r*60),t=WC_PAO.Helper.addMinutes(t,60*i)),n.val(t.getTime()/1e3),o.show()):(o.hide(),n.val(""))}),o.on("click",function(e){e.preventDefault(),n.val(""),a.val("").trigger("change")})})},get_taxable_address:function(){var e="",t="",a="",o="";return"shipping"===woocommerce_admin_meta_boxes.tax_based_on&&(e=d("#_shipping_country").val(),t=d("#_shipping_state").val(),a=d("#_shipping_postcode").val(),o=d("#_shipping_city").val()),"billing"!==woocommerce_admin_meta_boxes.tax_based_on&&e||(e=d("#_billing_country").val(),t=d("#_billing_state").val(),a=d("#_billing_postcode").val(),o=d("#_billing_city").val()),{country:e,state:t,postcode:a,city:o}},block:function(e,t){t=d.extend({},{message:null,overlayCSS:{background:"#fff",opacity:.6}},t||{});e.block(t)},unblock:function(e){e.unblock()}};c.handle_events()});